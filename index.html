<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wheat Plant Detection</title>

  <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css"/>
  <script type="module" src="https://pyscript.net/releases/2025.11.2/core.js"></script>

  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header>
    <h1>Wheat Plant Detection</h1>
    <p>Use this AI to classify your wheat plant into one of 7 categories.</p>
  </header>

  <div class="upload-section">
    <div class="button-row">
      <label for="imageInput" class="upload-label">Choose Image</label>
      <button id="classifyBtn" class="upload-btn">Classify</button>
    </div>

    <input type="file" id="imageInput" accept="image/*" style="display:none;">

    <div id="preview-container">
      <img id="preview" style="display:none; max-width:300px; max-height:300px;">
    </div>
  </div>

  <div id="result" class="result-badge"></div>

<py-script>
# PyScript 2025-compatible script
import js
import random
from pyscript import when

categories = [
    'Rust', 'Pests', 'Mildew', 'Blight_Spot',
    'Smut_Rot', 'Fusarium_Blast', 'Healthy'
]

selected_file = None

# Mock classifier for now
def classifier(image_bytes: bytes):
    return random.choice(categories)

# ---- IMAGE PREVIEW (WORKING) ----
@when("change", "#imageInput")
def preview_image(event):
    global selected_file
    selected_file = event.target.files[0]

    if not selected_file:
        return

    # Use JS FileReader (modern, stable)
    file_reader = js.FileReader.new()

    def on_load(e):
        img = js.document.getElementById("preview")
        img.src = e.target.result
        img.style.display = "block"

    file_reader.onload = on_load
    file_reader.readAsDataURL(selected_file)

#classification
@when("click", "#classifyBtn")
async def classify_image(event):
    global selected_file
    if not selected_file:
        js.document.getElementById("result").innerText = "No image selected!"
        return

    # Convert JS file â†’ Python bytes
    array_buffer = await selected_file.arrayBuffer()
    uint8 = js.Uint8Array.new(array_buffer)
    image_bytes = bytes(uint8.to_py())

    # Mock classifier
    category = classifier(image_bytes)
    js.document.getElementById("result").innerText = f"Predicted: {category}"
</py-script>

</body>
</html>

