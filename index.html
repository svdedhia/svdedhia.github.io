<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wheat Plant Detection</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.9.0/dist/tf.min.js"></script>
  <style>
    #preview { max-width: 300px; max-height: 300px; display: none; }
    #result { margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>

<h1>Wheat Plant Detection</h1>
<input type="file" id="imageInput" accept="image/*">
<button id="classifyBtn">Classify</button>
<br>
<img id="preview">
<div id="result"></div>

<script>
  const categories = [
    'Rust','Pests','Mildew','Blight_Spot',
    'Smut_Rot','Fusarium_Blast','Healthy'
  ];

  let model;
  let selectedFile;

  // Load the model from same folder
  async function loadModel() {
    model = await tf.loadLayersModel('model.json');
    console.log("Model loaded!");
  }
  loadModel();

  // Preview selected image
  const imageInput = document.getElementById("imageInput");
  const preview = document.getElementById("preview");

  imageInput.addEventListener("change", (event) => {
    selectedFile = event.target.files[0];
    if (!selectedFile) return;

    const reader = new FileReader();
    reader.onload = (e) => {
      preview.src = e.target.result;
      preview.style.display = "block";
    }
    reader.readAsDataURL(selectedFile);
  });

  // Classify image
  const classifyBtn = document.getElementById("classifyBtn");
  const resultDiv = document.getElementById("result");

  classifyBtn.addEventListener("click", async () => {
    if (!selectedFile) {
      resultDiv.innerText = "No image selected!";
      return;
    }

    const img = new Image();
    img.src = preview.src;
    img.onload = async () => {
      let tensor = tf.browser.fromPixels(img)
                  .resizeNearestNeighbor([160, 160])
                  .toFloat()
                  .div(255.0)
                  .expandDims(0);

      const predictions = model.predict(tensor);
      const predIndex = predictions.argMax(-1).dataSync()[0];
      resultDiv.innerText = `Predicted: ${categories[predIndex]}`;
    }
  });
</script>

</body>
</html>
